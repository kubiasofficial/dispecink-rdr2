<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>DISPEƒåINK CRC v1.40</title>
    <style>
        :root { --bg: #121110; --card: #1c1a18; --accent: #b09060; --text: #d2c1ae; --success: #4a5d43; --danger: #8b2e2e; --modal-bg: rgba(0,0,0,0.9); }
        body { font-family: 'Georgia', serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; padding: 20px; }
        .container { background: var(--card); border: 1px solid var(--accent); width: 750px; padding: 30px; box-shadow: 0 10px 50px #000; border-radius: 8px; }
        
        .status-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; background: rgba(0,0,0,0.4); padding: 15px; border: 1px solid #444; margin-bottom: 20px; }
        .stat-val { display: block; font-weight: bold; color: var(--accent); font-size: 1.2rem; }

        .cargo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; background: rgba(0,0,0,0.2); padding: 15px; border: 1px solid #333; }
        .cargo-section h3 { font-size: 0.9rem; color: var(--accent); border-bottom: 1px solid #444; padding-bottom: 5px; }
        .cargo-item { display: flex; justify-content: space-between; padding: 5px 0; font-size: 0.85rem; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: var(--modal-bg); backdrop-filter: blur(8px); }
        .modal-content { background: var(--card); margin: 15% auto; padding: 30px; border: 1px solid var(--accent); width: 450px; text-align: center; }

        button { width: 100%; padding: 12px; margin: 10px 0; cursor: pointer; font-family: 'Georgia', serif; font-weight: bold; text-transform: uppercase; border: 1px solid var(--accent); transition: 0.3s; }
        .btn-gold { background: var(--accent); color: #1a1816; }
        .btn-outline { background: transparent; color: var(--accent); }
        .btn-green { background: var(--success); color: white; border: none; }
        
        input, select { width: 100%; padding: 10px; background: #000; color: var(--text); border: 1px solid #444; margin: 5px 0; box-sizing: border-box; }
        .hidden { display: none; }
        
        #active-timetable { background: #0a0a0a; padding: 10px; border: 1px solid #333; }
        .station-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; cursor: pointer; }
        .station-row:hover { background: rgba(176, 144, 96, 0.1); }
        .station-row.next { border-left: 4px solid var(--accent); background: rgba(176, 144, 96, 0.05); }
        .station-row.completed { color: #555; text-decoration: line-through; }
        .cargo-badge { font-size: 0.7rem; background: #5d4e37; color: #fff; padding: 2px 6px; border-radius: 3px; margin-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; letter-spacing:3px;">DISPEƒåINK CRC v1.40</h1>

    <div id="status-display" class="status-bar hidden">
        <div style="text-align:center">V√ùDƒöLEK<span id="stat-money" class="stat-val">0 USD</span></div>
        <div style="text-align:center">J√çZDENKY<span id="stat-tickets" class="stat-val">0 Ks</span></div>
        <div style="text-align:center">KOLO<span id="stat-round" class="stat-val">1 / 1</span></div>
        <div style="text-align:center">ZPO≈ΩDƒöN√ç<span id="stat-delay" class="stat-val">Vƒças</span></div>
    </div>

    <div id="step-setup" class="step">
        <label>Odpovƒõdn√Ω strojv≈Ødce:</label>
        <select id="user-select">
            <option value="Elizabeth Brown">Elizabeth Brown</option>
            <option value="Joshue Thorne">Joshue Thorne</option>
            <option value="Henry Brown">Henry Brown</option>
            <option value="Nicholas Carter">Nicholas Carter</option>
        </select>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
            <div>
                <label>Poƒçet kol ve smƒõnƒõ:</label>
                <input type="number" id="shift-rounds" value="3" min="1">
            </div>
            <div>
                <label>Pauza (minuty):</label>
                <input type="number" id="pause-duration" value="5">
            </div>
        </div>
        <button class="btn-gold" onclick="initShift()">NASTOUPIT DO SLU≈ΩBY</button>
    </div>

    <div id="step-prep" class="step hidden">
        <h2 id="prep-title" style="text-align:center; color:var(--accent);">P≈ò√çPRAVA KOLA 1</h2>
        <label>V√Ωbƒõr trasy:</label>
        <select id="route-select" onchange="updateCargoList()">
            <option value="0">LINIE I. - HLAVN√ç OKRUH</option>
            <option value="1">LINIE II. - Z√ÅPADN√ç SPOJKA</option>
        </select>

        <div class="cargo-grid">
            <div class="cargo-section">
                <h3>üì¶ NAKL√ÅDKA (Telegramy/Bal√≠ky)</h3>
                <div id="load-list"></div>
            </div>
            <div class="cargo-section">
                <h3>üì• VYKL√ÅDKA</h3>
                <div id="unload-list"></div>
            </div>
        </div>
        <button class="btn-gold" onclick="generateLeg()">GENEROVAT J√çZDN√ç ≈ò√ÅD</button>
    </div>

    <div id="step-drive" class="step hidden">
        <h2 id="drive-title" style="text-align:center;">PROTOKOL J√çZDY</h2>
        <div id="active-timetable"></div>
    </div>
</div>

<div id="ticket-modal" class="modal">
    <div class="modal-content">
        <h3>STANOVI≈†Tƒö: <span id="modal-station"></span></h3>
        <p>Zadejte poƒçet prodan√Ωch j√≠zdenek:</p>
        <input type="number" id="input-tickets" value="0" onfocus="this.select()">
        <button class="btn-gold" onclick="confirmStation()">POTVRDIT A ODJET</button>
    </div>
</div>

<div id="pause-modal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--accent)">‚òï P≈òEST√ÅVKA</h2>
        <p id="pause-msg"></p>
        <div id="pause-timer" style="font-size:2rem; margin:20px 0; font-weight:bold;">00:00</div>
        <button id="resume-btn" class="btn-green hidden" onclick="startNextRound()">HL√ÅS√çM ≈ΩE JSEM ZPƒöT</button>
    </div>
</div>

<audio id="coin-sound" src="mixkit-clinking-coins-1993.wav"></audio>

<script>
    const trasy = [
        { n: "LINIE I.", gap: 5, stop: ["Saint Denis", "Emerald", "Valentine", "Flatneck", "Riggs", "Wallace", "Annesburg", "Saint Denis"] },
        { n: "LINIE II.", gap: 6, stop: ["Saint Denis", "Rhodes", "Flatneck", "Blackwater", "MacFarlane", "Montana", "Valentine", "Saint Denis"] }
    ];

    let shift = {
        worker: "",
        maxRounds: 0,
        currentRound: 1,
        pauseMins: 0,
        totalMoney: 0,
        totalTickets: 0,
        activeRoute: null,
        stationIdx: 0,
        times: [],
        cargo: { load: [], unload: [] }
    };

    function initShift() {
        shift.worker = document.getElementById('user-select').value;
        shift.maxRounds = parseInt(document.getElementById('shift-rounds').value);
        shift.pauseMins = parseInt(document.getElementById('pause-duration').value);
        
        document.getElementById('step-setup').classList.add('hidden');
        showPrep();
    }

    function showPrep() {
        document.getElementById('step-prep').classList.remove('hidden');
        document.getElementById('status-display').classList.remove('hidden');
        document.getElementById('prep-title').innerText = `P≈ò√çPRAVA KOLA ${shift.currentRound} / ${shift.maxRounds}`;
        document.getElementById('stat-round').innerText = `${shift.currentRound} / ${shift.maxRounds}`;
        updateCargoList();
    }

    function updateCargoList() {
        const rIdx = document.getElementById('route-select').value;
        const stops = trasy[rIdx].stop;
        let loadHtml = ""; let unloadHtml = "";
        
        stops.forEach(s => {
            loadHtml += `<div class="cargo-item"><label>${s}</label><input type="checkbox" class="load-cb" value="${s}"></div>`;
            unloadHtml += `<div class="cargo-item"><label>${s}</label><input type="checkbox" class="unload-cb" value="${s}"></div>`;
        });
        document.getElementById('load-list').innerHTML = loadHtml;
        document.getElementById('unload-list').innerHTML = unloadHtml;
    }

    function generateLeg() {
        const rIdx = document.getElementById('route-select').value;
        shift.activeRoute = trasy[rIdx];
        shift.stationIdx = 0;
        
        // Sbƒõr vybran√© nakl√°dky
        shift.cargo.load = Array.from(document.querySelectorAll('.load-cb:checked')).map(cb => cb.value);
        shift.cargo.unload = Array.from(document.querySelectorAll('.unload-cb:checked')).map(cb => cb.value);

        // ƒåasy
        let now = new Date();
        shift.times = shift.activeRoute.stop.map((_, i) => new Date(now.getTime() + (i * shift.activeRoute.gap * 60000)));

        document.getElementById('step-prep').classList.add('hidden');
        document.getElementById('step-drive').classList.remove('hidden');
        renderTimetable();
    }

    function renderTimetable() {
        let html = "";
        shift.activeRoute.stop.forEach((s, i) => {
            const time = shift.times[i].toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            let cls = i < shift.stationIdx ? "completed" : (i === shift.stationIdx ? "next" : "");
            
            let badges = "";
            if(shift.cargo.load.includes(s)) badges += `<span class="cargo-badge">NAKL√ÅDKA</span>`;
            if(shift.cargo.unload.includes(s)) badges += `<span class="cargo-badge">VYKL√ÅDKA</span>`;

            html += `<div class="station-row ${cls}" onclick="openStation(${i})">
                        <span>${s} ${badges}</span><span>${time}</span>
                    </div>`;
        });
        document.getElementById('active-timetable').innerHTML = html;
    }

    function openStation(idx) {
        if(idx !== shift.stationIdx) return;
        document.getElementById('modal-station').innerText = shift.activeRoute.stop[idx];
        document.getElementById('ticket-modal').style.display = 'block';
    }

    function confirmStation() {
        const tix = parseInt(document.getElementById('input-tickets').value) || 0;
        shift.totalTickets += tix;
        shift.totalMoney += (tix * 5);
        
        document.getElementById('stat-tickets').innerText = shift.totalTickets;
        document.getElementById('stat-money').innerText = `${shift.totalMoney} USD`;
        document.getElementById('coin-sound').play();
        
        document.getElementById('ticket-modal').style.display = 'none';
        document.getElementById('input-tickets').value = 0;

        shift.stationIdx++;
        if(shift.stationIdx >= shift.activeRoute.stop.length) {
            finishRound();
        } else {
            renderTimetable();
        }
    }

    function finishRound() {
        if(shift.currentRound < shift.maxRounds) {
            startPause();
        } else {
            alert("SMƒöNA DOKONƒåENA! Skvƒõl√° pr√°ce.");
            location.reload();
        }
    }

    function startPause() {
        document.getElementById('step-drive').classList.add('hidden');
        const modal = document.getElementById('pause-modal');
        modal.style.display = 'block';

        let end = new Date(new Date().getTime() + shift.pauseMins * 60000);
        document.getElementById('pause-msg').innerText = `Ahoj ${shift.worker.split(' ')[0]}! Pr√°vƒõ ti zaƒçala p≈ôest√°vka, kter√° ti konƒç√≠ v ${end.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}.`;

        let timerObj = setInterval(() => {
            let diff = end - new Date();
            if(diff <= 0) {
                clearInterval(timerObj);
                document.getElementById('pause-timer').innerText = "KONEC PAUZY";
                document.getElementById('resume-btn').classList.remove('hidden');
            } else {
                let m = Math.floor(diff/60000);
                let s = Math.floor((diff%60000)/1000);
                document.getElementById('pause-timer').innerText = `${m}:${s.toString().padStart(2,'0')}`;
            }
        }, 1000);
    }

    function startNextRound() {
        shift.currentRound++;
        document.getElementById('pause-modal').style.display = 'none';
        document.getElementById('resume-btn').classList.add('hidden');
        showPrep();
    }
</script>
</body>
</html>
